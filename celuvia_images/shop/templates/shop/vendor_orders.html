{% extends "shop/base.html" %}
{% load static %}
{% block content %}
<div class="container my-5">
    <h2>Orders for Your Stores</h2>

    <!-- Filter by store -->
    <form method="get" class="mb-3 d-flex gap-2">
        <select name="store_id" class="form-select" style="width:auto;">
            <option value="">All stores</option>
            {% for store in stores %}
                <option value="{{ s.id }}" {% if store.id == selected_store %}selected{% endif %}>
                    {{ store.name }}
                </option>
            {% endfor %}
        </select>
        <button class="btn btn-outline-secondary">Filter</button>
    </form>

    <!-- Displays order from store -->
    {% if orders %}
        {% for order in orders %}
        <div class="card mb-4">

            <!-- Order details and customer name -->
            <div class="card-header">
                Order #{{ order.id }} - {{ order.user.full_name }} ({{ order.created_at|date:"j M Y, H:i" }})
            </div>

            <!-- Order table card -->
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Size</</th>
                            <th>Frame</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                        {% if item.product.store.owner == request.user %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.get_size_display }}</td>
                            <td>{{ item.frame_colour }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>£{{ item.price }}</td>
                            <td>£{{ item.get_subtotal|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Vendor total for the order -->
                <p><strong>Total for this order:</strong> £{{ order.vendor_total|floatformat:2 }}</p>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>No orders have been placed yet.</p>
    {% endif %}
</div>
{% endblock %}