{% extends "shop/base.html" %}
{% load static %}
{% block content %}
<div class="container my-5">
    <h2 class="text-center mb-4">Checkout</h2>
    <p class="text-center">
        Please enter your delivery and billing address details below.
    </p>

    <form action="{% url 'shop:checkout' %}" method="POST" class="mt-4">
        {% csrf_token %}

        <div class="row g-5">
            <!-- Shipping Address -->
            <div class="col-md-6">
                <h4 class="mb-3">Shipping Address</h4>

                {% for field in shipping_form %}
                    <div class="row mb-1 align-items-center">
                        <label for="{{ field.id_for_label }}" 
                               class="col-sm-4 col-form-label col-form-label-sm pe-1">
                            {{ field.label }}
                        </label>
                        <div class="col-sm-8">
                            {{ field }}
                            {% if field.errors %}
                                <div class="text-danger small">
                                    {{ field.errors|striptags }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}

                <div class="form-check mt-3">
                    <input type="checkbox" name="same_billing" id="same_billing"
                           class="form-check-input" checked>
                    <label for="same_billing" class="form-check-label">
                        Billing address same as shipping
                    </label>
                </div>
            </div>

            <!-- Billing Address -->
            <div class="col-md-6">
                <h4 class="mb-3">Billing Address</h4>

                <div id="billing-fields" class="ps-3">
                    {% for field in billing_form %}
                        <div class="row mb-1 align-items-center">
                            <label for="{{ field.id_for_label }}" 
                                   class="col-sm-4 col-form-label col-form-label-sm pe-1">
                                {{ field.label }}
                            </label>
                            <div class="col-sm-8">
                                {{ field }}
                                {% if field.errors %}
                                    <div class="text-danger small">
                                        {{ field.errors|striptags }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">
                Proceed to Payment
            </button>
            <a href="{% url 'shop:home' %}"
               class="btn btn-lg btn-secondary ms-2">
               Continue Shopping
            </a>
        </div>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const sameBillingCheckbox = document.getElementById("same_billing");
        const billingFieldsDiv = document.getElementById("billing-fields");

        const shippingFields = document.querySelectorAll('[id^="id_shipping_"]');
        const billingFields = document.querySelectorAll('[id^="id_billing_"]');

        function toggleBillingFields() {
            if (sameBillingCheckbox.checked) {
                billingFields.forEach((field, index) => {
                    field.value = shippingFields[index]?.value || '';
                });
                billingFieldsDiv.style.display = "none";
            } else {
                billingFields.forEach(field => field.value = '');
                billingFieldsDiv.style.display = "block";
            }
        }

        sameBillingCheckbox.addEventListener("change", toggleBillingFields);
        toggleBillingFields();
    });
</script>
{% endblock %}