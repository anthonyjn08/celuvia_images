{% extends "shop/base.html" %}
{% load static %}
{% block content %}
<div class="container my-5">
    <h2 class="text-center mb-4">Checkout</h2>
    <p class="text-center">
        Please enter your delivery and billing address details below.
    </p>

    <form action="{% url 'shop:checkout' %}" method="POST" class="mt-4">
        {% csrf_token %}

        <div class="row">
            <!-- Shipping Address -->
            <div class="col-md-6">
                <h4>Shipping Address</h4>
                {{ shipping_form.as_p }}
            </div>

            <!-- Billing Address -->
            <div class="col-md-6">
                <h4>Billing Address</h4>

                <div class="form-check mb-3">
                    <input type="checkbox" name="same_billing" id="same_billing"
                           class="form-check-input">
                    <label for="same_billing" class="form-check-label">
                        Billing address same as shipping
                    </label>
                </div>

                <div id="billing-fields">
                    {{ billing_form.as_p }}
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg">
                Proceed to Payment
            </button>
        </div>
    </form>

    <div class="text-end mt-3">
        <a href="{% url 'shop:product_list' %}"
           class="btn btn-lg btn-secondary">
            Continue Shopping
        </a>
    </div>
</div>

<!-- ===== JavaScript for syncing and hiding billing fields ===== -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const sameBillingCheckbox = document.getElementById("same_billing");
        const billingFieldsDiv = document.getElementById("billing-fields");

        const shippingFields = document.querySelectorAll('[id^="id_shipping_"]');
        const billingFields = document.querySelectorAll('[id^="id_billing_"]');

        function toggleBillingFields() {
            if (sameBillingCheckbox.checked) {
                // Copy values from shipping to billing
                billingFields.forEach((field, index) => {
                    field.value = shippingFields[index]?.value || '';
                });
                // Hide billing form section
                billingFieldsDiv.style.display = "none";
            } else {
                // Clear and show billing form section
                billingFields.forEach(field => field.value = '');
                billingFieldsDiv.style.display = "block";
            }
        }

        sameBillingCheckbox.addEventListener("change", toggleBillingFields);

        // Run once on page load (in case checkbox is pre-checked)
        toggleBillingFields();
    });
</script>
{% endblock %}